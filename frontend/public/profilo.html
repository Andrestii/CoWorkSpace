<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Il Mio Profilo - CoWorkSpace</title>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="icon" href="favicon.ico">

  <!-- Styles -->
  <link href="css/pagine/profilo.css" rel="stylesheet" />
 
</head>

<body>
  <!-- Navbar -->
  <div id="navbar-placeholder"></div>

  <!-- Profile Page -->
  <header class="container" id="profile-container">
    <div class="row align-items-center g-4">
      <div class="col-md-auto">
        <div class="avatar-container position-relative">
          <img src="https://via.placeholder.com/120" alt="Avatar" class="rounded-circle user-avatar"
            id="profile-image" />
          <div class="avatar-edit" id="avatar-edit-btn"><i class="fas fa-camera"></i></div>
          <input type="file" id="avatar-upload" accept="image/*" hidden />
        </div>
      </div>
      <div class="col">
        <h1 class="mb-1">Il Mio Profilo</h1>
        <p class="text-muted mb-2">Gestisci i tuoi dati personali e monitora le tue prenotazioni</p>
        <div class="pill-container">
          <p class="pill mt-1" id="user-role">RUOLO</p>
        </div>
      </div>
      <div class="col-md-4 col-lg-3 text-md-end">
        <h5 id="user-name" class="mb-1">Nome Cognome</h5>
        <p id="user-email" class="text-muted mb-0">email@email.com</p>
      </div>
    </div>
  </header>

  <!-- NAV dinamica -->
  <nav class="container mt-4">
    <div class="profile-nav d-flex flex-wrap gap-2">
      <!-- Comuni -->
      <div class="nav-item active" data-target="info-personali">
        <i class="fas fa-user me-2"></i> Informazioni Personali
      </div>
      <div class="nav-item" data-target="prenotazioni">
        <i class="fas fa-calendar-check me-2"></i> Le mie prenotazioni
        <span class="badge bg-secondary ms-2 d-none">0</span>
      </div>

      <!-- Gestore -->
      <div class="nav-item nav-gestore d-none" data-target="dash-gestore">
        <i class="fas fa-chart-line me-2"></i> Dashboard gestore
      </div>
      <div class="nav-item nav-gestore d-none" data-target="mie-sedi">
        <i class="fas fa-building me-2"></i> Le mie sedi
        <span class="badge bg-secondary ms-2 d-none">0</span>
      </div>
      <div class="nav-item nav-gestore d-none" data-target="miei-spazi">
        <i class="fas fa-chair me-2"></i> I miei spazi
        <span class="badge bg-secondary ms-2 d-none">0</span>
      </div>
      <div class="nav-item nav-gestore d-none" data-target="disponibilita">
        <i class="fas fa-clock me-2"></i> Disponibilità
      </div>
      <div class="nav-item nav-gestore d-none" data-target="prenotazioni-gestore">
        <i class="fas fa-list-check me-2"></i> Prenotazioni ricevute
        <span class="badge bg-secondary ms-2 d-none">0</span>
      </div>
    </div>
  </nav>

  <!-- Contenuti -->
  <main class="container my-4">
    <div class="profile-content-container">

      <!-- Info Personali -->
      <div class="content-section active" id="info-personali">
        <div class="content-card p-4 shadow-sm rounded">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h4>Informazioni Personali</h4>
            <div>
              <button class="btn btn-sm btn-outline-dark" id="edit-info-btn">
                <i class="fa-regular fa-pen-to-square"></i> Modifica
              </button>
            </div>
          </div>

          <form id="profile-form">
            <div class="row">
              <div class="mb-3">
                <label class="form-label">Nome e Cognome</label>
                <input type="text" class="form-control" id="nome-completo" readonly />
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" id="email" readonly />
            </div>
            <div class="mb-3">
              <label class="form-label">Telefono</label>
              <input type="text" class="form-control" id="telefono" readonly />
            </div>
            <div class="mb-3">
              <label class="form-label">Data di nascita</label>
              <input type="date" class="form-control" id="data-nascita" readonly />
            </div>
            <div class="text-end">
              <button type="button" class="btn btn-outline-secondary me-2 d-none" id="cancel-edit">Annulla</button>
              <button type="submit" class="btn btn-primary d-none" id="save-profile">Salva Modifiche</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Cliente: Le mie prenotazioni  -->
      <div class="content-section" id="prenotazioni" style="display:none;">
        <div class="content-header d-flex align-items-center justify-content-between mb-3">
          <h4 class="mb-0">Tutte le Prenotazioni</h4>
        </div>

        <div class="content-body">
          <div class="table-responsive">
            <table class="table align-middle" id="tab-mie-pren">
              <thead>
                <tr>
                  <th>Spazio</th>
                  <th>Stato</th>
                  <th>Totale</th>
                  <th>Data</th>
                  <th class="text-end">Azioni</th>
                </tr>
              </thead>
              <tbody>
                <!-- rows via JS -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Gestore: Dashboard sintetica -->
      <div class="content-section" id="dash-gestore" style="display:none;">
        <div class="row g-3">
          <div class="col-md-4">
            <div class="kpi-card">
              <div class="kpi-label">Prenotazioni oggi</div>
              <div class="kpi-value" id="kpi-ogg">—</div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="kpi-card">
              <div class="kpi-label">Settimana</div>
              <div class="kpi-value" id="kpi-week">—</div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="kpi-card">
              <div class="kpi-label">Mese</div>
              <div class="kpi-value" id="kpi-month">—</div>
            </div>
          </div>
        </div>
        <div class="card mt-4 shadow-sm">
          <div class="content-header">
            <h4>Ultime prenotazioni</h4>
            <a href="#" class="btn btn-sm btn-outline-primary" data-open="prenotazioni-gestore">Vai alla lista</a>
          </div>
          <div class="content-body" id="dash-ultime"></div>
        </div>
      </div>

      <!-- Gestore: Le mie sedi -->
      <div class="content-section" id="mie-sedi" style="display:none;">
        <div class="content-header">
          <h4>Le mie sedi</h4>
          <a href="sedi.html" class="btn btn-sm btn-outline-primary">Vai a Sedi</a>
        </div>
        <div class="content-body">
          <div class="row" id="mie-sedi-grid"></div>
        </div>
      </div>

      <!-- Gestore: I miei spazi -->
      <div class="content-section" id="miei-spazi" style="display:none;">
        <div class="content-header">
          <h4>I miei spazi</h4>
          <a href="spazi.html" class="btn btn-sm btn-outline-primary">Vai a Spazi</a>
        </div>
        <div class="content-body">
          <div class="row" id="miei-spazi-grid"></div>
        </div>
      </div>

      <!-- Gestore: Prenotazioni ricevute -->
      <div class="content-section" id="prenotazioni-gestore" style="display:none;">
        <div class="content-header">
          <h4>Prenotazioni ricevute</h4>
        </div>
        <div class="content-body">
          <div class="table-responsive">
            <table class="table align-middle" id="tab-pren-gestore">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Data</th>
                  <th>Sede</th>
                  <th>Cliente</th>
                  <th>Orario</th>
                  <th>Totale</th>
                  <th>Stato</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Gestore: Disponibilità -->
      <div class="content-section" id="disponibilita" style="display:none;">
        <div class="content-header">
          <h4>Gestione disponibilità</h4>
        </div>
        <div class="content-body">
          <p class="text-muted">Crea, modifica o elimina disponibilità degli spazi che gestisci.</p>
          <div id="disp-spazi-list" class="row g-3"></div>
        </div>
      </div>
    </div>
  </main>

    <!-- Toast globale -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1055">
      <div id="global-toast" class="toast align-items-center border-0" role="alert" aria-live="assertive"
        aria-atomic="true">
        <div class="d-flex">
          <div class="toast-body" id="global-toast-body">
            Operazione completata
          </div>
          <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Chiudi"></button>
        </div>
      </div>
    </div>

  <div id="footer-placeholder"></div>

    <!-- Scripts -->
    <script src="./scripts/config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="./scripts/auth.js"></script>
    <script src="./scripts/pages/profilo.js"></script>
    <script src="./scripts/partials/navbar.js"></script>
    <script src="./scripts/partials/footer.js"></script>

    <script>
      (function () {
        function setNavHeight() {
          const nav = document.querySelector('.navbar');
          const h = nav ? Math.ceil(nav.getBoundingClientRect().height) : 76;
          document.documentElement.style.setProperty('--nav-h', h + 'px');
        }
        setNavHeight();
        window.addEventListener('resize', setNavHeight);
        const obs = new MutationObserver(setNavHeight);
        obs.observe(document.body, { childList: true, subtree: true });
        window.addEventListener('load', setNavHeight);
      })();
    </script>

</body>

</html>